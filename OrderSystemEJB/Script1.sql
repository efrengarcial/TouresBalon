CONNECT 'jdbc:derby:JPATEST;create=true';


ALTER TABLE CUSTSCH.CUSTOMER  DROP FOREIGN KEY FK_ORDER ;
ALTER TABLE CUSTSCH.CUSTOMER  DROP FOREIGN KEY FK_OPORDER ;
ALTER TABLE CUSTSCH.LINEITEM  DROP FOREIGN KEY FK_PRODUCT ;
ALTER TABLE CUSTSCH.CUSTORDER DROP FOREIGN KEY FK_CUSTOMER ;

DROP TABLE CUSTSCH.CUSTOMER ;
DROP TABLE CUSTSCH.LINEITEM ;
DROP TABLE CUSTSCH.NEWIDS ;
DROP TABLE CUSTSCH.CUSTORDER ;
DROP TABLE CUSTSCH.PRODUCT ;

DROP SCHEMA CUSTSCH RESTRICT ;

COMMIT WORK ;

CREATE SCHEMA CUSTSCH ;

CREATE TABLE CUSTSCH.CUSTOMER (
		NAME VARCHAR(250),
		CUST_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 20, INCREMENT BY 1) ,
		OPEN_ORDER_ID INTEGER
	) ;

CREATE TABLE CUSTSCH.LINEITEM (
		LI_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) ,
		ORDER_ID INTEGER NOT NULL,
		PRODUCT_ID INTEGER NOT NULL,
		QUANTITY INTEGER,
		AMOUNT DOUBLE
	) ;

CREATE TABLE CUSTSCH.NEWIDS (
		TABLE_ID INTEGER NOT NULL,
		NEXT_ID INTEGER NOT NULL
	) ;

CREATE TABLE CUSTSCH.CUSTORDER (
		ORDER_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 6, INCREMENT BY 1),
		STATUS VARCHAR(250),
		TOTAL DOUBLE,
		CUSTOMER_ID INTEGER NOT NULL
	) ;

CREATE TABLE CUSTSCH.PRODUCT (
		SKU INTEGER NOT NULL,
		DESCRIPT VARCHAR(250),
		PRICE DOUBLE
	) ;

ALTER TABLE CUSTSCH.CUSTOMER ADD CONSTRAINT PK_CUSTOMER PRIMARY KEY (CUST_ID);

ALTER TABLE CUSTSCH.LINEITEM ADD CONSTRAINT PK_ITEM PRIMARY KEY (LI_ID);

ALTER TABLE CUSTSCH.NEWIDS ADD CONSTRAINT PK_NEWIDS PRIMARY KEY (TABLE_ID);

ALTER TABLE CUSTSCH.CUSTORDER ADD CONSTRAINT PK_ORDER PRIMARY KEY (ORDER_ID);

ALTER TABLE CUSTSCH.PRODUCT ADD CONSTRAINT PK_PRODUCT PRIMARY KEY (SKU);

ALTER TABLE CUSTSCH.CUSTOMER ADD CONSTRAINT FK_OPORDER FOREIGN KEY (OPEN_ORDER_ID)
	REFERENCES CUSTSCH.CUSTORDER (ORDER_ID);

ALTER TABLE CUSTSCH.LINEITEM ADD CONSTRAINT FK_ORDER FOREIGN KEY (ORDER_ID)
	REFERENCES CUSTSCH.CUSTORDER (ORDER_ID);

ALTER TABLE CUSTSCH.LINEITEM ADD CONSTRAINT FK_PRODUCT FOREIGN KEY (PRODUCT_ID)
	REFERENCES CUSTSCH.PRODUCT (SKU);

ALTER TABLE CUSTSCH.CUSTORDER ADD CONSTRAINT FK_CUSTOMER FOREIGN KEY (CUSTOMER_ID)
	REFERENCES CUSTSCH.CUSTOMER (CUST_ID);


INSERT INTO CUSTSCH.PRODUCT(SKU,DESCRIPT , PRICE) VALUES (122,'Play Station 2', 100);
INSERT INTO CUSTSCH.PRODUCT(SKU,DESCRIPT , PRICE) VALUES (32,'Soda Case', 33);
INSERT INTO CUSTSCH.PRODUCT(SKU,DESCRIPT , PRICE) VALUES (232,'DVD Player', 432);
INSERT INTO CUSTSCH.PRODUCT(SKU,DESCRIPT , PRICE) VALUES (22,'VCR', 223);
INSERT INTO CUSTSCH.PRODUCT(SKU,DESCRIPT , PRICE) VALUES (12,'Mp3 Player', 88);

INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Robert Peterson', 1);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Geoffrey Hambrick', 2);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Kyle Brown', 3);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Keys Botzum', 4);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Tom Alcott', 5);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Bill Hines', 6);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Gang Chen', 7);
INSERT INTO CUSTSCH.CUSTOMER(NAME, CUST_ID) VALUES ('Roland Barcia', 8);



INSERT INTO CUSTSCH.CUSTORDER (ORDER_ID, STATUS, TOTAL, CUSTOMER_ID) VALUES (1, 'OPEN', 88, 1);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 1, 12, 1, 88);

INSERT INTO CUSTSCH.CUSTORDER (ORDER_ID, STATUS, TOTAL, CUSTOMER_ID) VALUES (2, 'OPEN', 188, 5);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 2, 12, 1, 88);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 2, 122, 1, 100);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 2, 32, 3, 99);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 2, 22, 1, 100);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 2, 122, 1, 77);


INSERT INTO CUSTSCH.CUSTORDER (ORDER_ID, STATUS, TOTAL, CUSTOMER_ID) VALUES (3, 'OPEN', 664, 4);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 3, 12, 1, 88);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 3, 232, 1, 432);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 3, 122, 1, 100);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 3, 122, 1, 44);

INSERT INTO CUSTSCH.CUSTORDER (ORDER_ID, STATUS, TOTAL, CUSTOMER_ID) VALUES (4, 'OPEN', 580, 3);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 4, 232, 1, 432);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 4, 32, 2, 60);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 4, 12, 1, 88);


INSERT INTO CUSTSCH.CUSTORDER (ORDER_ID, STATUS, TOTAL, CUSTOMER_ID) VALUES (5, 'OPEN', 527, 2);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 5, 12, 1, 88);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 5, 32, 3, 99);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 5, 22, 1, 100);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 5, 122, 1, 77);
INSERT INTO CUSTSCH.LINEITEM(ORDER_ID, PRODUCT_ID, QUANTITY, AMOUNT) VALUES ( 5, 232, 1, 77);

UPDATE CUSTSCH.CUSTOMER SET OPEN_ORDER_ID = 1  WHERE CUST_ID = 1;
UPDATE CUSTSCH.CUSTOMER SET OPEN_ORDER_ID = 5  WHERE CUST_ID = 2;
UPDATE CUSTSCH.CUSTOMER SET OPEN_ORDER_ID = 4  WHERE CUST_ID = 3;
UPDATE CUSTSCH.CUSTOMER SET OPEN_ORDER_ID = 3  WHERE CUST_ID = 4;
UPDATE CUSTSCH.CUSTOMER SET OPEN_ORDER_ID = 2  WHERE CUST_ID = 5;

INSERT INTO CUSTSCH.NEWIDS (TABLE_ID,NEXT_ID) VALUES (1,1238);
INSERT INTO CUSTSCH.NEWIDS (TABLE_ID,NEXT_ID) VALUES (2,9);
INSERT INTO CUSTSCH.NEWIDS (TABLE_ID,NEXT_ID) VALUES (3,6);

COMMIT WORK;


DISCONNECT;



